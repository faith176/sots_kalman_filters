{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SensorConfigList",
  "type": "object",
  "required": ["sensors"],
  "properties": {
    "sensors": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SetupDatastreamConfig"
      }
    }
  },
  "definitions": {
    "SetupDatastreamConfig": {
      "type": "object",
      "required": ["sensor_id", "stream_type", "source_endpoint", "sampling_interval_sec", "filter"],
      "properties": {
        "sensor_id": { "type": "string" },
        "stream_type": { "type": "string" },
        "units": { "type": "string" },
        "source_endpoint": { "type": "string", "format": "uri" },
        "sampling_interval_sec": { "type": "number", "minimum": 0.01 },
        "filter": {
          "type": "object",
          "required": ["type"],
          "properties": {
            "type": { "type": "string", "enum": ["2D", "3D"] },
            "initial_value": { "type": "number" },
            "initial_rate": { "type": "number" },
            "initial_acceleration": { "type": "number" },
            "initial_variance": { "type": "number", "minimum": 0 },
            "dt": { "type": "number", "minimum": 0 },
            "process_noise": { "type": "number", "minimum": 0 },
            "measurement_noise": { "type": "number", "minimum": 0 }
          },
          "additionalProperties": false,
          "allOf": [
            {
              "if": { "properties": { "type": { "const": "3D" }}},
              "then": { "required": ["initial_acceleration"] }
            },
            {
              "if": { "properties": { "type": { "const": "2D" }}},
              "then": { "not": { "required": ["initial_acceleration"] }}
            }
          ]
        }
      },
      "additionalProperties": false
    }
  }
}
